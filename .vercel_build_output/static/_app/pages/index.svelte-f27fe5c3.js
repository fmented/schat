import{S as $,i as j,s as q,e as h,t as I,k as L,c as v,a as N,h as S,d as g,m as P,b as d,g as J,J as n,L as W,M as R,j as te,K as C,N as H,O as ue,v as se,l as x,o as M,p as ce,q as Y,n as fe,w as re,x as le,y as ae,B as ne}from"../chunks/vendor-1841b722.js";import{s as oe,A as ie}from"../chunks/index-a1babe66.js";import{S as pe}from"../chunks/bridge-0fce5198.js";import{c as K}from"../chunks/singletons-d1fb5791.js";function _e(o){let e,s,t=(o[4]?"Please Wait":o[3])+"",a,c,l,b,p,i,r,u,k,T,_,B,w,A,O,U,y,f,V,D,F;return{c(){e=h("div"),s=h("p"),a=I(t),c=L(),l=h("label"),b=I("Username"),p=L(),i=h("input"),r=L(),u=h("label"),k=I("Email"),T=L(),_=h("input"),B=L(),w=h("label"),A=I("Password"),O=L(),U=h("input"),y=L(),f=h("button"),V=I("Sign Up"),this.h()},l(E){e=v(E,"DIV",{class:!0});var m=N(e);s=v(m,"P",{});var G=N(s);a=S(G,t),G.forEach(g),c=P(m),l=v(m,"LABEL",{for:!0});var Q=N(l);b=S(Q,"Username"),Q.forEach(g),p=P(m),i=v(m,"INPUT",{type:!0,id:!0,class:!0}),r=P(m),u=v(m,"LABEL",{for:!0});var Z=N(u);k=S(Z,"Email"),Z.forEach(g),T=P(m),_=v(m,"INPUT",{type:!0,id:!0,class:!0}),B=P(m),w=v(m,"LABEL",{for:!0});var z=N(w);A=S(z,"Password"),z.forEach(g),O=P(m),U=v(m,"INPUT",{type:!0,id:!0,class:!0}),y=P(m),f=v(m,"BUTTON",{class:!0});var X=N(f);V=S(X,"Sign Up"),X.forEach(g),m.forEach(g),this.h()},h(){d(l,"for","username"),d(i,"type","text"),d(i,"id","username"),d(i,"class","svelte-9b1v7l"),d(u,"for","email"),d(_,"type","text"),d(_,"id","email"),d(_,"class","svelte-9b1v7l"),d(w,"for","password"),d(U,"type","password"),d(U,"id","password"),d(U,"class","svelte-9b1v7l"),d(f,"class","svelte-9b1v7l"),d(e,"class","wrap svelte-9b1v7l")},m(E,m){J(E,e,m),n(e,s),n(s,a),n(e,c),n(e,l),n(l,b),n(e,p),n(e,i),W(i,o[0]),n(e,r),n(e,u),n(u,k),n(e,T),n(e,_),W(_,o[2]),n(e,B),n(e,w),n(w,A),n(e,O),n(e,U),W(U,o[1]),n(e,y),n(e,f),n(f,V),D||(F=[R(i,"input",o[6]),R(_,"input",o[7]),R(U,"input",o[8]),R(f,"click",o[5])],D=!0)},p(E,[m]){m&24&&t!==(t=(E[4]?"Please Wait":E[3])+"")&&te(a,t),m&1&&i.value!==E[0]&&W(i,E[0]),m&4&&_.value!==E[2]&&W(_,E[2]),m&2&&U.value!==E[1]&&W(U,E[1])},i:C,o:C,d(E){E&&g(e),D=!1,H(F)}}}function de(o,e,s){let t="",a="",c="",l="";const b=ue();let p=!1;async function i(){if(!t||!a||!c)return;s(4,p=!0);const T=await oe(ie.AUTH_SIGNUP,{username:t,password:a,email:c},fetch);if(T.ok){const{status:_}=await T.json();_=="error"?s(3,l="username or email is already used"):b("created")}s(4,p=!1)}function r(){t=this.value,s(0,t)}function u(){c=this.value,s(2,c)}function k(){a=this.value,s(1,a)}return[t,a,c,l,p,i,r,u,k]}class me extends ${constructor(e){super();j(this,e,de,_e,q,{})}}const be="BMWNvV8BJW950f_My9KgC7aVQKR2Y-vNFV0K3iuR9R_TJ-WtkKQkT58EEP8ch_s6PCHaYYbDk_isc8T5ZBtNgfg";K.disable_scroll_handling;K.goto;K.invalidate;K.prefetch;K.prefetch_routes;K.before_navigate;K.after_navigate;function he(o){let e,s,t=(o[3]?"Please Wait":o[2])+"",a,c,l,b,p,i,r,u,k,T,_,B,w,A,O,U;return{c(){e=h("div"),s=h("p"),a=I(t),c=L(),l=h("label"),b=I("Username"),p=L(),i=h("input"),r=L(),u=h("label"),k=I("Password"),T=L(),_=h("input"),B=L(),w=h("button"),A=I("Login"),this.h()},l(y){e=v(y,"DIV",{class:!0});var f=N(e);s=v(f,"P",{});var V=N(s);a=S(V,t),V.forEach(g),c=P(f),l=v(f,"LABEL",{for:!0});var D=N(l);b=S(D,"Username"),D.forEach(g),p=P(f),i=v(f,"INPUT",{type:!0,id:!0,class:!0}),r=P(f),u=v(f,"LABEL",{for:!0});var F=N(u);k=S(F,"Password"),F.forEach(g),T=P(f),_=v(f,"INPUT",{type:!0,id:!0,class:!0}),B=P(f),w=v(f,"BUTTON",{class:!0});var E=N(w);A=S(E,"Login"),E.forEach(g),f.forEach(g),this.h()},h(){d(l,"for","username"),d(i,"type","text"),d(i,"id","username"),d(i,"class","svelte-1mxmbul"),d(u,"for","password"),d(_,"type","password"),d(_,"id","password"),d(_,"class","svelte-1mxmbul"),w.disabled=o[3],d(w,"class","svelte-1mxmbul"),d(e,"class","wrap svelte-1mxmbul")},m(y,f){J(y,e,f),n(e,s),n(s,a),n(e,c),n(e,l),n(l,b),n(e,p),n(e,i),W(i,o[0]),n(e,r),n(e,u),n(u,k),n(e,T),n(e,_),W(_,o[1]),n(e,B),n(e,w),n(w,A),O||(U=[R(i,"input",o[5]),R(_,"input",o[6]),R(w,"click",o[4])],O=!0)},p(y,[f]){f&12&&t!==(t=(y[3]?"Please Wait":y[2])+"")&&te(a,t),f&1&&i.value!==y[0]&&W(i,y[0]),f&2&&_.value!==y[1]&&W(_,y[1]),f&8&&(w.disabled=y[3])},i:C,o:C,d(y){y&&g(e),O=!1,H(U)}}}function ve(o,e,s){let t="",a="",c,l="";se(()=>{c=new pe(navigator.serviceWorker)});let b=!1;async function p(){if(!t||!a)return;s(3,b=!0),s(2,l="");const u=await oe(ie.AUTH_LOGIN,{username:t,password:a},window.fetch);if(u.ok){const{status:k,message:T}=await u.json();if(k=="error")return s(2,l=T),s(3,b=!1);const B=await(await navigator.serviceWorker.ready).pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:be}),w=B.toJSON().keys.p256dh,A=B.toJSON().keys.p256dh,O={endpoint:B.endpoint,keys:{auth:A,p256dh:w},username:t};c.emit("after_login",O),c.on("subscribed",U=>{localStorage.setItem("deviceId",U),window.location.href="/chat"})}s(3,b=!1)}function i(){t=this.value,s(0,t)}function r(){a=this.value,s(1,a)}return[t,a,l,b,p,i,r]}class ge extends ${constructor(e){super();j(this,e,ve,he,q,{})}}function ee(o){let e,s,t,a,c,l,b,p;return{c(){e=h("div"),s=h("button"),t=I("Sign Up"),a=L(),c=h("button"),l=I("Login")},l(i){e=v(i,"DIV",{});var r=N(e);s=v(r,"BUTTON",{});var u=N(s);t=S(u,"Sign Up"),u.forEach(g),a=P(r),c=v(r,"BUTTON",{});var k=N(c);l=S(k,"Login"),k.forEach(g),r.forEach(g)},m(i,r){J(i,e,r),n(e,s),n(s,t),n(e,a),n(e,c),n(c,l),b||(p=[R(s,"click",o[2]),R(c,"click",o[3])],b=!0)},p:C,d(i){i&&g(e),b=!1,H(p)}}}function ke(o){let e,s;return e=new ge({}),e.$on("fail",o[5]),{c(){re(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,a){ae(e,t,a),s=!0},p:C,i(t){s||(Y(e.$$.fragment,t),s=!0)},o(t){M(e.$$.fragment,t),s=!1},d(t){ne(e,t)}}}function we(o){let e,s;return e=new me({}),e.$on("created",o[4]),{c(){re(e.$$.fragment)},l(t){le(e.$$.fragment,t)},m(t,a){ae(e,t,a),s=!0},p:C,i(t){s||(Y(e.$$.fragment,t),s=!0)},o(t){M(e.$$.fragment,t),s=!1},d(t){ne(e,t)}}}function ye(o){let e,s,t,a,c,l=!o[0]&&ee(o);const b=[we,ke],p=[];function i(r,u){return r[1]==="register"?0:1}return s=i(o),t=p[s]=b[s](o),{c(){l&&l.c(),e=L(),t.c(),a=x()},l(r){l&&l.l(r),e=P(r),t.l(r),a=x()},m(r,u){l&&l.m(r,u),J(r,e,u),p[s].m(r,u),J(r,a,u),c=!0},p(r,[u]){r[0]?l&&(l.d(1),l=null):l?l.p(r,u):(l=ee(r),l.c(),l.m(e.parentNode,e));let k=s;s=i(r),s===k?p[s].p(r,u):(fe(),M(p[k],1,1,()=>{p[k]=null}),ce(),t=p[s],t?t.p(r,u):(t=p[s]=b[s](r),t.c()),Y(t,1),t.m(a.parentNode,a))},i(r){c||(Y(t),c=!0)},o(r){M(t),c=!1},d(r){l&&l.d(r),r&&g(e),p[s].d(r),r&&g(a)}}}const Te=async({session:o})=>o.user?{status:301,redirect:"/chat"}:{};function Ee(o,e,s){let t=!1,a="register";return se(async()=>{}),[t,a,()=>s(1,a="register"),()=>s(1,a="login"),()=>{s(0,t=!0),s(1,a="login")},()=>s(0,t=!0)]}class Be extends ${constructor(e){super();j(this,e,Ee,ye,q,{})}}export{Be as default,Te as load};
