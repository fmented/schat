import{P as Z,S as $,i as ee,s as te,e as _,t as P,c as p,a as b,h as U,d as h,b as i,g as Y,J as t,M as y,K as C,k as E,m as q,Q as j,L as z,N as se,R as ae}from"../chunks/vendor-1841b722.js";import{i as le,s as re}from"../chunks/helper-7d864c4a.js";import{s as G,A as H}from"../chunks/index-a1babe66.js";function ie(){return`https://avatars.dicebear.com/api/bottts/${Z()}.svg`}function F(l){let e,s,a,m;return{c(){e=_("span"),s=P("\u274C"),this.h()},l(n){e=p(n,"SPAN",{class:!0});var r=b(e);s=U(r,"\u274C"),r.forEach(h),this.h()},h(){i(e,"class","svelte-1x3gqmm")},m(n,r){Y(n,e,r),t(e,s),a||(m=y(e,"click",l[6]),a=!0)},p:C,d(n){n&&h(e),a=!1,m()}}}function oe(l){let e,s,a,m,n,r,T,L,B,v,c,g,k,d,D,w,N,O,R,x,A,M,V,J,o=l[0]&&F(l);return{c(){e=_("main"),s=_("div"),a=_("label"),m=P("Pic"),n=E(),r=_("img"),L=E(),o&&o.c(),B=E(),v=_("div"),c=_("label"),g=P("Bio"),k=E(),d=_("textarea"),D=E(),w=_("button"),N=P("Save"),O=E(),R=_("hr"),x=E(),A=_("button"),M=P("Logout"),this.h()},l(f){e=p(f,"MAIN",{class:!0});var u=b(e);s=p(u,"DIV",{class:!0});var I=b(s);a=p(I,"LABEL",{for:!0,class:!0});var K=b(a);m=U(K,"Pic"),K.forEach(h),n=q(I),r=p(I,"IMG",{src:!0,alt:!0,class:!0}),L=q(I),o&&o.l(I),I.forEach(h),B=q(u),v=p(u,"DIV",{class:!0});var S=b(v);c=p(S,"LABEL",{for:!0,class:!0});var Q=b(c);g=U(Q,"Bio"),Q.forEach(h),k=q(S),d=p(S,"TEXTAREA",{id:!0,rows:!0}),b(d).forEach(h),D=q(S),w=p(S,"BUTTON",{class:!0});var W=b(w);N=U(W,"Save"),W.forEach(h),S.forEach(h),O=q(u),R=p(u,"HR",{class:!0}),x=q(u),A=p(u,"BUTTON",{class:!0});var X=b(A);M=U(X,"Logout"),X.forEach(h),u.forEach(h),this.h()},h(){i(a,"for","pic"),i(a,"class","svelte-1x3gqmm"),j(r.src,T=l[0]?l[0]:l[2].avatar)||i(r,"src",T),i(r,"alt","user profile"),i(r,"class","svelte-1x3gqmm"),i(s,"class","ava svelte-1x3gqmm"),i(c,"for","bio"),i(c,"class","svelte-1x3gqmm"),i(d,"id",""),i(d,"rows","6"),i(w,"class","svelte-1x3gqmm"),i(v,"class","bio svelte-1x3gqmm"),i(R,"class","svelte-1x3gqmm"),i(A,"class","svelte-1x3gqmm"),i(e,"class","svelte-1x3gqmm")},m(f,u){Y(f,e,u),t(e,s),t(s,a),t(a,m),t(s,n),t(s,r),t(s,L),o&&o.m(s,null),t(e,B),t(e,v),t(v,c),t(c,g),t(v,k),t(v,d),z(d,l[1]),t(v,D),t(v,w),t(w,N),t(e,O),t(e,R),t(e,x),t(e,A),t(A,M),V||(J=[y(r,"click",l[5]),y(d,"input",l[7]),y(w,"click",l[3]),y(A,"click",l[4])],V=!0)},p(f,[u]){u&5&&!j(r.src,T=f[0]?f[0]:f[2].avatar)&&i(r,"src",T),f[0]?o?o.p(f,u):(o=F(f),o.c(),o.m(s,null)):o&&(o.d(1),o=null),u&2&&z(d,f[1])},i:C,o:C,d(f){f&&h(e),o&&o.d(),V=!1,se(J)}}}const fe=async({session:l})=>l.user?{}:{status:301,redirect:"/"};function ne(l,e,s){let a;ae(l,re,c=>s(2,a=c));let m="",n=a.bio;async function r(){const c=le(a.user);await c.open();const g=await c.tables.profile.retrieve(k=>k.username);await c.close(),m&&m!==a.avatar&&await G(H.UPDATE_AVATAR,{receiver:g,content:m}),n!==a.bio&&await G(H.UPDATE_BIO,{receiver:g,content:n}),window.location.reload()}async function T(){const c=localStorage.getItem("deviceId");if((await G(H.AUTH_LOGOUT,{deviceId:c})).ok){const d=await(await navigator.serviceWorker.ready).pushManager.getSubscription();d&&await d.unsubscribe(),localStorage.removeItem("deviceId"),window.location.href="/"}}const L=()=>s(0,m=ie()),B=()=>{s(0,m="")};function v(){n=this.value,s(1,n)}return[m,n,a,r,T,L,B,v]}class ve extends ${constructor(e){super();ee(this,e,ne,oe,te,{})}}export{ve as default,fe as load};
